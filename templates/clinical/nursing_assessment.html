<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nursing Assessment</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .tab-button.active {
            background-color: #1a56db; /* Primary blue for active tab */
            color: white;
        }
        .tab-content.hidden {
            display: none;
        }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto bg-white shadow-lg rounded-lg p-6 sm:p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Nursing Assessment</h1>

        <!-- Messages Section -->
        {% if messages %}
            <div class="mb-6">
                {% for message in messages %}
                    <div class="p-4 mb-2 text-sm rounded-md
                                {% if message.tags == 'success' %}bg-green-100 text-green-700{% elif message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %}"
                         role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Patient Details Section -->
        <div class="bg-gray-50 p-4 rounded-md shadow-sm mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Patient Information</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="flex flex-col">
                    <span class="text-sm font-medium text-gray-500">UHID:</span>
                    <span class="text-gray-900 font-semibold">{{ uhid }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-medium text-gray-500">Patient Name:</span>
                    <span class="text-gray-900 font-semibold">{{ patient_name }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-medium text-gray-500">Date of Birth:</span>
                    <span class="text-gray-900 font-semibold">{{ dob }}</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-medium text-gray-500">Gender:</span>
                    <span class="text-gray-900 font-semibold">{{ gender }}</span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="-mb-px flex flex-wrap gap-2 sm:gap-0" aria-label="Tabs">
                <button type="button" class="tab-button active inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="presenting-complaints">
                    Presenting Complaints
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="history-examination">
                    History & Examination
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="diagnosis">
                    Diagnosis
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="investigation-procedure">
                    Investigation & Procedure
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="prescription-medicine">
                    Prescription Medicine
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="advice">
                    Advice
                </button>
                <button type="button" class="tab-button inline-flex items-center justify-center p-3 border-b-2 border-transparent text-sm font-medium text-gray-600 hover:text-gray-800 hover:border-gray-300 rounded-t-md focus:outline-none transition duration-150 ease-in-out" data-tab="medical-certificate">
                    Medical Certificate
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div id="tab-content-container">
            <!-- Presenting Complaints Tab -->
            <div id="presenting-complaints" class="tab-content">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Presenting Complaints</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="presenting_complaint_temp" value="PresentingComplaintTemp">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="presenting_comp" class="block text-sm font-medium text-gray-700">Presenting Complaint</label>
                            <textarea id="presenting_comp" name="presenting_comp" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                        </div>
                        <div>
                            <label for="initial_comp" class="block text-sm font-medium text-gray-700">Initial Complaint</label>
                            <input type="text" id="initial_comp" name="initial_comp" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Add Temporary Complaint
                    </button>
                </form>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Temporary Complaints Added:</h3>
                    {% if present_complains %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Presenting Complaint</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Initial Complaint</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for complaint in present_complains %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ complaint.presenting_comp }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ complaint.initial_comp }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <form method="post" action="" class="mt-4">
                            {% csrf_token %}
                            <input type="hidden" name="presenting_complaint_main" value="PresentingComplaintMain">
                            {% for complaint in present_complains %}
                                <input type="hidden" name="presenting_comp_sub" value="{{ complaint.presenting_comp }}">
                                <input type="hidden" name="initial_comp_sub" value="{{ complaint.initial_comp }}">
                            {% endfor %}
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                Finalize Presenting Complaints
                            </button>
                        </form>
                    {% else %}
                        <p class="text-gray-500">No temporary presenting complaints added yet.</p>
                    {% endif %}
                </div>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Finalized Presenting Complaints:</h3>
                    {% if present_sub %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Presenting Complaint</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Initial Complaint</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for complaint in present_sub %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ complaint.presenting_comp }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ complaint.initial_comp }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-gray-500">No finalized presenting complaints.</p>
                    {% endif %}
                </div>
            </div>

            <!-- History and Examination Tab -->
            <div id="history-examination" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">History & Examination</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="His_and_exam" value="HistoryAndExamination">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% comment %} Assuming form fields are rendered by pm_form.as_p or similar for Django forms {% endcomment %}
                        {% if history_diagnosis.first %}
                            <div>
                                <label for="general_examination" class="block text-sm font-medium text-gray-700">General Examination</label>
                                <textarea id="general_examination" name="general_examination" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.general_examination }}</textarea>
                            </div>
                            <div>
                                <label for="Cardiovascular" class="block text-sm font-medium text-gray-700">Cardiovascular</label>
                                <textarea id="Cardiovascular" name="Cardiovascular" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Cardiovascular }}</textarea>
                            </div>
                            <div>
                                <label for="Respiration" class="block text-sm font-medium text-gray-700">Respiration</label>
                                <textarea id="Respiration" name="Respiration" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Respiration }}</textarea>
                            </div>
                            <div>
                                <label for="Past_Medical_Surgical" class="block text-sm font-medium text-gray-700">Past Medical/Surgical</label>
                                <textarea id="Past_Medical_Surgical" name="Past_Medical_Surgical" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Past_Medical_Surgical }}</textarea>
                            </div>
                            <div>
                                <label for="Musculoskeletal" class="block text-sm font-medium text-gray-700">Musculoskeletal</label>
                                <textarea id="Musculoskeletal" name="Musculoskeletal" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Musculoskeletal }}</textarea>
                            </div>
                            <div>
                                <label for="Family_History" class="block text-sm font-medium text-gray-700">Family History</label>
                                <textarea id="Family_History" name="Family_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Family_History }}</textarea>
                            </div>
                            <div>
                                <label for="Paediatric_History" class="block text-sm font-medium text-gray-700">Paediatric History</label>
                                <textarea id="Paediatric_History" name="Paediatric_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Paediatric_History }}</textarea>
                            </div>
                            <div>
                                <label for="Gynaec_Obstetric_History" class="block text-sm font-medium text-gray-700">Gynaec/Obstetric History</label>
                                <textarea id="Gynaec_Obstetric_History" name="Gynaec_Obstetric_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Gynaec_Obstetric_History }}</textarea>
                            </div>
                            <div>
                                <label for="Vaginal_Examination" class="block text-sm font-medium text-gray-700">Vaginal Examination</label>
                                <textarea id="Vaginal_Examination" name="Vaginal_Examination" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ history_diagnosis.first.Vaginal_Examination }}</textarea>
                            </div>
                        {% else %}
                            <div>
                                <label for="general_examination" class="block text-sm font-medium text-gray-700">General Examination</label>
                                <textarea id="general_examination" name="general_examination" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Cardiovascular" class="block text-sm font-medium text-gray-700">Cardiovascular</label>
                                <textarea id="Cardiovascular" name="Cardiovascular" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Respiration" class="block text-sm font-medium text-gray-700">Respiration</label>
                                <textarea id="Respiration" name="Respiration" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Past_Medical_Surgical" class="block text-sm font-medium text-gray-700">Past Medical/Surgical</label>
                                <textarea id="Past_Medical_Surgical" name="Past_Medical_Surgical" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Musculoskeletal" class="block text-sm font-medium text-gray-700">Musculoskeletal</label>
                                <textarea id="Musculoskeletal" name="Musculoskeletal" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Family_History" class="block text-sm font-medium text-gray-700">Family History</label>
                                <textarea id="Family_History" name="Family_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Paediatric_History" class="block text-sm font-medium text-gray-700">Paediatric History</label>
                                <textarea id="Paediatric_History" name="Paediatric_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Gynaec_Obstetric_History" class="block text-sm font-medium text-gray-700">Gynaec/Obstetric History</label>
                                <textarea id="Gynaec_Obstetric_History" name="Gynaec_Obstetric_History" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                            <div>
                                <label for="Vaginal_Examination" class="block text-sm font-medium text-gray-700">Vaginal Examination</label>
                                <textarea id="Vaginal_Examination" name="Vaginal_Examination" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2"></textarea>
                            </div>
                        {% endif %}
                    </div>
                    <div class="mt-6">
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Save History & Examination
                        </button>
                    </div>
                </form>
            </div>

            <!-- Diagnosis Tab -->
            <div id="diagnosis" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Diagnosis</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="diagno" value="DiagnosisTemp">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="diagnosis_text" class="block text-sm font-medium text-gray-700">Diagnosis</label>
                            <input type="text" id="diagnosis_text" name="diagnosis" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                        <div>
                            <label for="diagnosis_id" class="block text-sm font-medium text-gray-700">Diagnosis ID (GRG Code)</label>
                            <input type="text" id="diagnosis_id" name="diagnosis_id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Add Temporary Diagnosis
                    </button>
                </form>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Temporary Diagnosis Added:</h3>
                    {% if diagnosis %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diagnosis</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GRG Code</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for diag in diagnosis %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ diag.diagnosis }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ diag.D_GRG_Code }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <form method="post" action="" class="mt-4">
                            {% csrf_token %}
                            <input type="hidden" name="diagnosis_main_b" value="DiagnosisMain">
                            {% for diag in diagnosis %}
                                <input type="hidden" name="diagnosis_main" value="{{ diag.diagnosis }}">
                                <input type="hidden" name="D_GRG_Codes_main" value="{{ diag.D_GRG_Code }}">
                            {% endfor %}
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                Finalize Diagnosis
                            </button>
                        </form>
                    {% else %}
                        <p class="text-gray-500">No temporary diagnosis added yet.</p>
                    {% endif %}
                </div>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Finalized Diagnosis:</h3>
                    {% if diagnosis_sub %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diagnosis</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GRG Code</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for diag in diagnosis_sub %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ diag.diagnosis }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ diag.D_GRG_Code }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-gray-500">No finalized diagnosis records.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Investigation and Procedure Tab -->
            <div id="investigation-procedure" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Investigation & Procedure</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="inves_proce" value="InvestigationAndProcedure">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 items-end">
                        <div>
                            <label for="investigation_and_procedure" class="block text-sm font-medium text-gray-700">Service Name</label>
                            <select id="investigation_and_procedure" name="investigation_and_procedure" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                                <option value="">Select Service</option>
                                {% for service in service_list %}
                                    <option value="{{ service.service_id }}">{{ service.service_id }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="status" name="status" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2">
                            <label for="status" class="text-sm font-medium text-gray-700">Status Active</label>
                        </div>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Add Investigation/Procedure
                    </button>
                </form>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Added Investigations & Procedures:</h3>
                    {% if invest_and_proce_records %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Service</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for record in invest_and_proce_records %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.investigation_and_procedure }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.status|yesno:"Active,Inactive" }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <form method="post" action="" class="mt-4">
                            {% csrf_token %}
                            <input type="hidden" name="to_opd" value="OPD_Billing">
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Send to OPD Billing
                            </button>
                        </form>
                    {% else %}
                        <p class="text-gray-500">No investigations or procedures added yet.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Prescription Medicine Tab -->
            <div id="prescription-medicine" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Prescription Medicine</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="pre_medicine_btn" value="Prescription_medicine">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label for="medical_list" class="block text-sm font-medium text-gray-700">Medicine</label>
                            <select id="medical_list" name="medical_list" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                                <option value="">Select Medicine</option>
                                {% for medicine in medical_list %}
                                    <option value="{{ medicine.item_name }}" {% if pre_medicine.medicine == medicine.item_name %}selected{% endif %}>{{ medicine.item_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="dosage" class="block text-sm font-medium text-gray-700">Dosage</label>
                            <input type="text" id="dosage" name="dosage" value="{{ pre_medicine.dosage|default:'' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                        <div>
                            <label for="frequency" class="block text-sm font-medium text-gray-700">Frequency</label>
                            <input type="text" id="frequency" name="frequency" value="{{ pre_medicine.frequency|default:'' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                        <div>
                            <label for="duration" class="block text-sm font-medium text-gray-700">Duration</label>
                            <input type="text" id="duration" name="duration" value="{{ pre_medicine.duration|default:'' }}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        </div>
                        <div>
                            <label for="instructions" class="block text-sm font-medium text-gray-700">Instructions</label>
                            <textarea id="instructions" name="instructions" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{{ pre_medicine.instructions|default:'' }}</textarea>
                        </div>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Save Prescription Medicine
                    </button>
                </form>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Prescribed Medicines:</h3>
                    {% if recordsss %}
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-md overflow-hidden">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Medicine</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dosage</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Frequency</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Instructions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for record in recordsss %}
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.medicine }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.dosage }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.frequency }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.duration }}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ record.instructions }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-gray-500">No prescribed medicines added yet.</p>
                    {% endif %}
                </div>

                <form method="post" action="" class="mt-6">
                    {% csrf_token %}
                    <input type="hidden" name="prescription_report" value="report">
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Generate Prescription Report (PDF)
                    </button>
                </form>
            </div>

            <!-- Advice Tab -->
            <div id="advice" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Advice</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="advice" value="Advices">
                    <div class="mb-4">
                        <label for="advice_text" class="block text-sm font-medium text-gray-700">Advice</label>
                        <textarea id="advice_text" name="advice" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">{% if advice.first %}{{ advice.first.advice }}{% endif %}</textarea>
                    </div>
                    <div class="mb-4">
                        <label for="follow_up_date" class="block text-sm font-medium text-gray-700">Follow-up Date</label>
                        <input type="date" id="follow_up_date" name="follow_up_date" value="{% if advice.first %}{{ advice.first.follow_up_date|date:'Y-m-d' }}{% endif %}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="refer_to_emergency" name="refer_to_emergency" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" {% if advice.first and "refer_to_emergency" in advice.first.follow_check_box %}checked{% endif %}>
                            <label for="refer_to_emergency" class="text-sm font-medium text-gray-700">Refer to Emergency</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="refer_to_admission" name="refer_to_admission" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" {% if advice.first and "refer_to_admission" in advice.first.follow_check_box %}checked{% endif %}>
                            <label for="refer_to_admission" class="text-sm font-medium text-gray-700">Refer to Admission</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="visit_complete" name="visit_complete" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" {% if advice.first and "visit_complete" in advice.first.follow_check_box %}checked{% endif %}>
                            <label for="visit_complete" class="text-sm font-medium text-gray-700">Visit Complete</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="refer_to_mental_health" name="refer_to_mental_health" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2" {% if advice.first and "refer_to_mental_health" in advice.first.follow_check_box %}checked{% endif %}>
                            <label for="refer_to_mental_health" class="text-sm font-medium text-gray-700">Refer to Mental Health</label>
                        </div>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Save Advice
                    </button>
                </form>
            </div>

            <!-- Medical Certificate Tab -->
            <div id="medical-certificate" class="tab-content hidden">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Medical Certificate</h2>
                <form method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="medical_certificate" value="MedicalCertificate">
                    <div class="mb-4">
                        <label for="template" class="block text-sm font-medium text-gray-700">Certificate Template</label>
                        <input type="text" id="template" name="template" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                    </div>
                    <div class="mb-4">
                        <label for="authorize_dr" class="block text-sm font-medium text-gray-700">Authorized Doctor</label>
                        <input type="text" id="authorize_dr" name="authorize_dr" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                    </div>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="finalized" name="finalized" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded mr-2">
                        <label for="finalized" class="text-sm font-medium text-gray-700">Finalized</label>
                    </div>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Save Medical Certificate
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Deactivate all buttons and hide all contents
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'bg-blue-600', 'text-white');
                        btn.classList.add('text-gray-600', 'hover:text-gray-800', 'hover:border-gray-300');
                    });
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });

                    // Activate the clicked button and show its content
                    const tabId = button.dataset.tab;
                    button.classList.add('active', 'bg-blue-600', 'text-white');
                    button.classList.remove('text-gray-600', 'hover:text-gray-800', 'hover:border-gray-300');
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });

            // Set initial active tab (Presenting Complaints)
            const initialTab = document.querySelector('.tab-button[data-tab="presenting-complaints"]');
            if (initialTab) {
                initialTab.click();
            }
        });
    </script>
</body>
</html>
